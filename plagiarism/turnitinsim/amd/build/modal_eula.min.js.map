{"version":3,"sources":["../src/modal_eula.js"],"names":["define","$","Notification","CustomEvents","Modal","ModalRegistry","ModalEvents","Config","registered","SELECTORS","EULA_LINK","ACCEPT_BUTTON","CANCEL_BUTTON","ModalTcEula","root","call","TYPE","prototype","Object","create","constructor","registerEventListeners","getModal","on","events","activate","e","preventDefault","window","open","wwwroot","sesskey","modal","ajax","type","url","dataType","data","action","contextid","success","hide","link","location","origin","pathname","search","href","bind","cancelEvent","Event","cancel","getRoot","trigger","isDefaultPrevented","originalEvent","register"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for the Delete assignment part modal.\n *\n * @package   plagiarism_turnitinsim\n * @copyright 2018 Turnitin\n * @author    John McGettrick <jmcgettrick@turnitin.com>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module plagiarism_turnitinsim/modal_eula\n */\n\ndefine(\n    [\n        'jquery',\n        'core/notification',\n        'core/custom_interaction_events',\n        'core/modal',\n        'core/modal_registry',\n        'core/modal_events',\n        'core/config'\n    ],\n    function($, Notification, CustomEvents, Modal, ModalRegistry, ModalEvents, Config) {\n\n        var registered = false;\n        var SELECTORS = {\n            EULA_LINK: '[class=\"eula_link\"]',\n            ACCEPT_BUTTON: '[data-action=\"accept-eula\"]',\n            CANCEL_BUTTON: '[data-action=\"cancel\"]'\n        };\n\n        /**\n         * Constructor for the Modal.\n         *\n         * @param {object} root The root jQuery element for the modal\n         */\n        var ModalTcEula = function(root) {\n            Modal.call(this, root);\n        };\n\n        ModalTcEula.TYPE = 'plagiarism_turnitinsim-modal_eula';\n        ModalTcEula.prototype = Object.create(Modal.prototype);\n        ModalTcEula.prototype.constructor = ModalTcEula;\n\n        /**\n         * Set up all of the event handling for the modal.\n         *\n         * @method registerEventListeners\n         */\n        ModalTcEula.prototype.registerEventListeners = function() {\n            // Apply parent event listeners.\n            Modal.prototype.registerEventListeners.call(this);\n\n            // On clicking the EULA link, open in a new window.\n            this.getModal().on(CustomEvents.events.activate, SELECTORS.EULA_LINK, function(e) {\n                e.preventDefault();\n                window.open(\n                    Config.wwwroot + '/plagiarism/turnitinsim/eula.php?cmd=eularedirect&sesskey=' + Config.sesskey,\n                    '_blank'\n                );\n            });\n\n            // On accepting the EULA, update the db and queue submissions for this module.\n            this.getModal().on(CustomEvents.events.activate, SELECTORS.ACCEPT_BUTTON, function() {\n                var modal = this;\n\n                $.ajax({\n                    type: \"POST\",\n                    url: Config.wwwroot + \"/plagiarism/turnitinsim/ajax/eula_response.php\",\n                    dataType: \"json\",\n                    data: {\n                        action: 'accept_eula',\n                        contextid: Config.contextid,\n                        sesskey: Config.sesskey\n                    },\n                    success: function() {\n                        modal.hide();\n                        var link = window.location.origin + window.location.pathname + window.location.search + '&eula=1';\n                        window.location.href = link;\n                    }\n                });\n\n            }.bind(this));\n\n            // On cancel, then hide the modal.\n            this.getModal().on(CustomEvents.events.activate, SELECTORS.CANCEL_BUTTON, function(e, data) {\n\n                var cancelEvent = $.Event(ModalEvents.cancel);\n                this.getRoot().trigger(cancelEvent, this);\n\n                if (!cancelEvent.isDefaultPrevented()) {\n                    this.hide();\n                    data.originalEvent.preventDefault();\n                }\n            }.bind(this));\n        };\n\n        // Automatically register with the modal registry the first time this module is imported so that\n        // you can create modals of this type using the modal factory.\n        if (!registered) {\n            ModalRegistry.register(ModalTcEula.TYPE, ModalTcEula, 'plagiarism_turnitinsim/modal_eula');\n            registered = true;\n        }\n\n        return ModalTcEula;\n    }\n);"],"file":"modal_eula.min.js"}